<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>بحبك يا ندى</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { margin:0; overflow:hidden; background:black; }
  canvas { display:block; }
</style>
</head>
<body>

<script src="https://cdn.jsdelivr.net/npm/three@0.136/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.136/examples/js/controls/OrbitControls.js"></script>
<script src="https://unpkg.com/gsap@3/dist/gsap.min.js"></script>

<script>
// ==== SETUP SCENE ====
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 2000);
camera.position.z = 700;

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(devicePixelRatio);
document.body.appendChild(renderer.domElement);

// ==== ORBIT CONTROLS ====
const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;
controls.dampingFactor = 0.05;
controls.enableZoom = true;

// ==== HEART FUNCTION ====
function heartShape(t){
  const x = 16 * Math.pow(Math.sin(t),3);
  const y = 13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t);
  return {x,y};
}

// ==== CREATE HEART POINTS (TARGET POSITIONS) ====
const heartPts = [];
for(let i=0;i<1500;i++){
  const t = Math.random()*Math.PI*2;
  const p = heartShape(t);
  heartPts.push(new THREE.Vector3(
    p.x*15 + (Math.random()-0.5)*2,
    p.y*15 + (Math.random()-0.5)*2,
    (Math.random()-0.5)*10
  ));
}

// ==== CREATE TEXT POINTS ====
function createTextParticles(text, fontSize){
  const c = document.createElement("canvas");
  c.width = 900;
  c.height = 300;
  const ctx = c.getContext("2d");

  ctx.fillStyle = "black";
  ctx.fillRect(0,0,c.width,c.height);

  ctx.font = `bold ${fontSize}px Arial`;
  ctx.fillStyle = "white";
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  ctx.fillText(text, c.width/2, c.height/2);

  const data = ctx.getImageData(0,0,c.width,c.height).data;
  const pts = [];
  for(let y=0;y<c.height;y+=4){
    for(let x=0;x<c.width;x+=4){
      const i=(y*c.width+x)*4;
      if(data[i]>200){
        pts.push(new THREE.Vector3(
          (x-c.width/2)*0.6,
          -(y-c.height/2)*0.6,
          (Math.random()-0.5)*5
        ));
      }
    }
  }
  return pts;
}

const textPts = createTextParticles("M♥️N = بحبك يا قلب الزوز", 50);

// ==== COMBINE TARGET POSITIONS ====
const targetPts = heartPts.concat(textPts);

// ==== CREATE PARTICLES INITIALLY RANDOM ====
const allPts = [];
for(let i=0;i<targetPts.length;i++){
  allPts.push(new THREE.Vector3(
    (Math.random()-0.5)*1000,
    (Math.random()-0.5)*800,
    (Math.random()-0.5)*800
  ));
}

// ==== CREATE PARTICLE SPEEDS FOR STAR-LIKE MOVEMENT ====
const speeds = [];
for(let i=0;i<allPts.length;i++){
  speeds.push({
    vx: (Math.random()-0.5)*2,
    vy: (Math.random()-0.5)*2,
    vz: (Math.random()-0.5)*2
  });
}

const geo = new THREE.BufferGeometry().setFromPoints(allPts);
const mat = new THREE.PointsMaterial({color:0xff66ff,size:3});
const points = new THREE.Points(geo, mat);
scene.add(points);

// ==== ANIMATION LOOP ====
let forming = true;
let timer = 0;
function animateParticles(){
  timer += 0.01;
  for(let i=0;i<allPts.length;i++){
    if(forming){
      // تتحرك نحو الهدف
      allPts[i].x += (targetPts[i].x - allPts[i].x)*0.02;
      allPts[i].y += (targetPts[i].y - allPts[i].y)*0.02;
      allPts[i].z += (targetPts[i].z - allPts[i].z)*0.02;
    } else {
      // تتحرك بشكل نجوم
      allPts[i].x += speeds[i].vx;
      allPts[i].y += speeds[i].vy;
      allPts[i].z += speeds[i].vz;

      // حدود الفضاء
      if(allPts[i].x>1200||allPts[i].x<-1200) speeds[i].vx*=-1;
      if(allPts[i].y>1000||allPts[i].y<-1000) speeds[i].vy*=-1;
      if(allPts[i].z>1000||allPts[i].z<-1000) speeds[i].vz*=-1;
    }

    // jitter صغير
    allPts[i].x += (Math.random()-0.5)*0.05;
    allPts[i].y += (Math.random()-0.5)*0.05;
    allPts[i].z += (Math.random()-0.5)*0.05;
  }
  geo.setFromPoints(allPts);

  // كل 4 ثواني، تبديل بين التجمع والتبعثر
  if(timer>4){
    forming = !forming;
    timer = 0;
    if(!forming){
      // إعادة توليد سرعات جديدة لكل نجمة
      for(let i=0;i<speeds.length;i++){
        speeds[i].vx = (Math.random()-0.5)*4;
        speeds[i].vy = (Math.random()-0.5)*4;
        speeds[i].vz = (Math.random()-0.5)*4;
      }
    }
  }
}

// ==== RENDER LOOP ====
function animate(){
  requestAnimationFrame(animate);
  animateParticles();
  controls.update();
  renderer.render(scene,camera);
}
animate();

// ==== RESIZE ====
addEventListener("resize", ()=>{
  camera.aspect = innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>

</body>
</html>
